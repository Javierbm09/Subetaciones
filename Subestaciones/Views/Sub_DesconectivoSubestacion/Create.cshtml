@model Subestaciones.Models.Sub_DesconectivoSubestacion

@{
    ViewBag.Title = "Breaker por Baja";
    ViewBag.PTitle = "Insertar Breaker por Baja de Red de Corriente Alterna";

}

@section breadcrumb{
    <li><a href="#"><i class="ti-layout-accordion-list"></i></a></li>
    <li><a href="@Url.Action("Index","Sub_RedCorrienteAlterna")">Red de Corriente Alterna</a></li>
    <li class="active">Insertar</li>
}

@section styles{
    <link href="@Url.Content("~/Content/plugins/sweetalert/sweetalert.css")" rel="stylesheet" />
}

<div class="panel panel-bordered-primary">
    <div class="panel-heading">
        <h3 class="panel-title"><b>Insertar Breaker por Baja de Red de Corriente Alterna</b></h3>
    </div>
    <hr />
    <div class="panel-body">
        @using (Html.BeginForm())
        {
            @Html.AntiForgeryToken()

            <div class="form">
                @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <input hidden="hidden" id="idRedCA" value="@Model.RedCA" />
                            <label class="control-label">Red de Corriente Alterna</label>
                            <input type="text" class="form-control" value="@ViewBag.RedCA" readonly="readonly" />
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="control-label">Subestación</label>
                            <input id="codigo-subestacion" type="text" class="form-control" value="@Model.CodigoSub" readonly="readonly" />
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-8">
                        <div class="form-group tablecontainer">
                            <a id="insertar-breakerPorBaja" class="btn btn-primary" data-target="#demo-lg-modal" data-toggle="modal" href="#">Insertar nuevo breaker por baja</a>

                            <div id="demo-lg-modal" class="modal fade" tabindex="-1">
                                <div class="modal-dialog modal-lg">
                                    <div id="modal-crear" class="modal-content" style="width:unset">

                                    </div>
                                </div>
                            </div>


                            <table id="datatable_brakerporBaja" class="table table-striped table-bordered table-hover">
                                <thead>
                                    <tr>
                                        <th>Codigo</th>
                                        <th>Tension Nominal</th>
                                        <th>Corriente Nominal</th>

                                        <th>Editar</th>
                                        <th>Eliminar</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-sm-12">
                    <button type="submit" class="btn btn-success"><i class="fa fa-plus"></i> Insertar Red Corriente Alterna</button>
                    <a class="btn btn-default" href="@Url.Action("Index", "Sub_RedCorrienteAlterna")"><i class="fa fa-list"></i> Listado de Redes de Corriente Alterna</a>
                </div>
            </div>
        }
    </div>
</div>

@section script{
    <script src="@Url.Content("~/Scripts/custom/select2.js")"></script>
    <script src="@Url.Content("~/Content/plugins/sweetalert/sweetalert.min.js")"></script>
    <script src="~/Scripts/custom/datatables.js"></script>
    <script>
        //$(document).ready(function () {
            var id_RedCA = $("#idRedCA").val();
            var subestacion = $("#codigo-subestacion").val();

            var table = $("#datatable_brakerporBaja").DataTable({
                "ajax": {
                    "url": '/Sub_DesconectivoSubestacion/GetBreakerPorbaja/' + id_RedCA + '',
                    "type": "get",
                    "datatype": "json",
                    "data": { "idRedCA": id_RedCA }
                },
                "columns": [
                    { "data": "CodigoDesconectivo", "autoWitdth": true },
                    { "data": "TensionNominal", "autoWidth": true },
                    { "data": "CorrienteNominal", "autoWith": true },
                    {
                        "data": "idRedCA", "with": "50px", "render": function (data, type, row) {
                            var funcion = "EditarBreaker('" + row.CodigoDesconectivo + "')";
                            return '<a href="javascript:;" class="btn btn-warning btn-xs" title="Editar" data-target="#demo-lg-modal" data-toggle="modal" onclick="' + funcion + ';"><i class="fa fa-pencil"></i></a>';

                        }
                    },
                    {
                        "data": "idRedCA", "with": "50px", "render": function (data, type, row) {
                            var funcionE = "EliminaBreaker('" + row.CodigoDesconectivo + "')";
                            return '<a href="javascript:;" class="btn btn-danger btn-xs" title="Eliminar" onclick="' + funcionE + ';"><i class="fa fa-trash-o"></i></a>';

                        }
                    },
                ]
            });

            $("#insertar-breakerPorBaja").on("click", function () {
                @*$.ajax({
                    url: '@Url.Action("CargarFomularioBreakerPorBaja", "Sub_DesconectivoSubestacion")',
                    method: 'POST',
                    data: { idRedCA: id_RedCA, codigoSubestacion: subestacion }  ,
                    success: function (data) {
                        $("#modal-crear").html(data);
                    }
                });*@

                $("#modal-crear").load('@Url.Action("CargarFomularioBreakerPorBaja", "Sub_DesconectivoSubestacion")', { idRedCA: id_RedCA, codigoSubestacion: subestacion });
            });

             $("#editar").on("click", function () {

                $("#modal-crear").load('@Url.Action("EditarBreakerPorBaja", "Sub_DesconectivoSubestacion")', { idRedCA: id_RedCA, codigoSubestacion: subestacion, codigoDesc: CodigoDesconectivo });
            });

             function EditarBreaker(codigo) {
                $("#modal-crear").load('@Url.Action("CargarFomularioBreakerPorBaja", "Sub_DesconectivoSubestacion")', { idRedCA: id_RedCA, codigoSubestacion: subestacion, codigoDesc: codigo });
            };
            function EliminaBreaker(codigo) {

                var baseUrl = $('base').attr('href');

                swal({
                    title: "¿Está seguro de eliminar el breaker por baja seleccionado?",
                    text: "¡Los valores que están en la fila a eliminar no se podrán recuperar!",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#DD6B55",
                    confirmButtonText: "¡Sí, eliminar!",
                    cancelButtonText: "¡No, cancelar!",
                    closeOnConfirm: false,
                    closeOnCancel: false
                }, function (isConfirm) {
                    if (isConfirm) {
                        $.ajax({
                            url: baseUrl + 'Sub_DesconectivoSubestacion/EliminaDesconectivoSubestacion',
                            method: "POST",
                            data: { idRedCA: id_RedCA, codigoSubestacion: subestacion, codigoDesconectivo: codigo },
                            success: function (data) {
                                table.ajax.reload();
                                if (data) {
                                    swal({
                                        title: "¡Eliminado!",
                                        text: "La fila seleccionada ha sido eliminada.",
                                        type: "success",
                                        confirmButtonText: "Cerrar",
                                        confirmButtonClass: "btn-primary"
                                    });
                                    // table.ajax.reload();

                                } else {
                                    swal({
                                        title: "¡Cancelado!",
                                        text: "¡A ocurrido un error, no se puedo eliminar la red!",
                                        type: "error",
                                        confirmButtonText: "Cerrar",
                                        confirmButtonClass: "btn-primary"
                                    });
                                }

                            },
                            error: function (data) {
                                console.log(data);
                            }
                        });

                    } else {
                        swal("Cancelado", "Los datos han sido salvados", "error")
                    }
                });

            }
        //});

    </script>
}